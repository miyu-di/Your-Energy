{"version":3,"file":"modals-C-0z28le.js","sources":["../../src/js/modals.js"],"sourcesContent":["import { getExerciseById, patchRating } from './api.js';\nimport iconSprite from '../images/icons.svg';\n\nconst modalBackdrop = document.querySelector('#exercise-modal');\nconst exercisesList = document.querySelector('.exercises-list');\nlet currentExerciseData = null;\n\nif (exercisesList) {\n  exercisesList.addEventListener('click', async e => {\n    const startBtn = e.target.closest('.exercise-start-btn');\n    if (!startBtn) return;\n    try {\n      const data = await getExerciseById(startBtn.dataset.id);\n      if (data) openModal(data);\n    } catch (err) {\n      console.error(err);\n    }\n  });\n}\n\nexport function openModal(data) {\n  currentExerciseData = data;\n  modalBackdrop.innerHTML = createModalMarkup(data);\n  modalBackdrop.classList.remove('is-hidden');\n  document.body.classList.add('no-scroll');\n\n  window.addEventListener('keydown', handleEsc);\n  initFavoriteBtn(data);\n}\n\nfunction initFavoriteBtn(data) {\n  const favBtn = document.querySelector('.btn-favorite');\n  if (!favBtn) return;\n  const favorites = JSON.parse(localStorage.getItem('favorites')) || [];\n  const isFavorite = favorites.some(item => item._id === data._id);\n  updateFavBtnState(favBtn, isFavorite);\n  favBtn.addEventListener('click', () => {\n    const currentFavs = JSON.parse(localStorage.getItem('favorites')) || [];\n    const index = currentFavs.findIndex(item => item._id === data._id);\n    if (index !== -1) {\n      currentFavs.splice(index, 1);\n      updateFavBtnState(favBtn, false);\n    } else {\n      currentFavs.push(data);\n      updateFavBtnState(favBtn, true);\n    }\n    localStorage.setItem('favorites', JSON.stringify(currentFavs));\n  });\n}\n\nfunction updateFavBtnState(btn, isFav) {\n  if (isFav) {\n    btn.innerHTML = `Remove from favorites <svg class=\"modal-heart\" width=\"20\" height=\"20\"><use href=\"${iconSprite}#heart\"></use></svg>`;\n  } else {\n    btn.innerHTML = `Add to favorites <svg class=\"modal-heart\" width=\"20\" height=\"20\"><use href=\"${iconSprite}#heart\"></use></svg>`;\n  }\n}\n\nfunction closeModal() {\n  modalBackdrop.classList.add('is-hidden');\n  modalBackdrop.innerHTML = '';\n  document.body.classList.remove('no-scroll');\n  window.removeEventListener('keydown', handleEsc);\n  if (window.location.pathname.includes('favorite')) {\n    const event = new Event('favorites-updated');\n    window.dispatchEvent(event);\n  }\n}\n\nfunction handleEsc(e) {\n  if (e.code === 'Escape') closeModal();\n}\n\nif (modalBackdrop) {\n  modalBackdrop.addEventListener('click', e => {\n    if (e.target === modalBackdrop || e.target.closest('#modal-close')) {\n      closeModal();\n    }\n  });\n}\n\ndocument.addEventListener('click', e => {\n  if (e.target.classList.contains('btn-rating')) {\n    modalBackdrop.innerHTML = createRatingMarkup(currentExerciseData._id);\n    initRatingLogic();\n  }\n});\n\n\nfunction initRatingLogic() {\n  let selectedRating = 0;\n  const radios = document.querySelectorAll('.rating-radio'); \n  const ratingValueLabel = document.querySelector('#rating-value');\n  const form = document.getElementById('rating-form');\n  const labels = document.querySelectorAll('.rating-label'); \n\n  radios.forEach(radio => {\n    radio.addEventListener('change', e => {\n      selectedRating = Number(e.target.value);\n      ratingValueLabel.textContent = `${selectedRating}.0`;\n\n      labels.forEach(label => {\n        const labelValue = Number(label.dataset.value);\n        const icon = label.querySelector('svg');\n\n        if (labelValue <= selectedRating) {\n          icon.style.fill = '#EEA10C';\n          icon.style.stroke = '#EEA10C';\n        } else {\n          icon.style.fill = 'rgba(244, 244, 244, 0.2)'; \n          icon.style.stroke = 'rgba(244, 244, 244, 0.2)'; \n        }\n      });\n    });\n  });\n\n  if (!form) return;\n\n  form.onsubmit = async e => {\n    e.preventDefault();\n    const { email, comment } = e.target.elements;\n\n    if (selectedRating === 0) return alert('Please select a rating!');\n\n    try {\n      await patchRating(currentExerciseData._id, {\n        rate: selectedRating,\n        email: email.value.trim(),\n        comment: comment.value.trim(),\n      });\n\n      alert('Thank you for your feedback!');\n      openModal(currentExerciseData);\n    } catch (err) {\n      alert(err.response?.data?.message || 'Error submitting rating');\n    }\n  };\n}\n\n\nfunction createRatingMarkup(exerciseId) {\n  return `\n    <div class=\"modal-content rating-modal\">\n      <button type=\"button\" class=\"modal-close-btn\" id=\"modal-close\">\n        <svg class=\"modal-close-icon\" width=\"28\" height=\"28\"><use href=\"${iconSprite}#cross\"></use></svg>\n      </button>\n      <p class=\"rating-label\">Rating</p>\n      <div class=\"rating-value-container\">\n        <span id=\"rating-value\">0.0</span>\n        \n        <div class=\"star-rating-wrapper\">\n            ${[1, 2, 3, 4, 5]\n              .map(\n                i => `\n                <div class=\"rating-group\">\n                    <input class=\"rating-radio visually-hidden\" type=\"radio\" name=\"rate\" id=\"star${i}\" value=\"${i}\">\n                    <label class=\"rating-label\" for=\"star${i}\" data-value=\"${i}\">\n                        <svg class=\"rating-star-icon\" width=\"24\" height=\"24\">\n                            <use href=\"${iconSprite}#star\"></use>\n                        </svg>\n                    </label>\n                </div>\n            `\n              )\n              .join('')}\n        </div>\n      </div>\n\n      <form class=\"rating-form\" id=\"rating-form\">\n        <input type=\"email\" name=\"email\" placeholder=\"Email\" required \n               pattern=\"^\\\\w+(\\\\.\\\\w+)?@[a-zA-Z_]+?\\\\.[a-zA-Z]{2,3}$\" class=\"rating-input\"/>\n        <textarea name=\"comment\" placeholder=\"Your comment\" required class=\"rating-textarea\"></textarea>\n        <button type=\"submit\" class=\"rating-send-btn\">Send</button>\n      </form>\n    </div>\n    \n    <style>\n        \n    </style>\n    `;\n}\n\n\nfunction createModalMarkup(data) {\n  const {\n    gifUrl,\n    name,\n    rating,\n    target,\n    bodyPart,\n    equipment,\n    popularity,\n    burnedCalories,\n    description,\n    _id,\n  } = data;\n\n  return `\n    <div class=\"modal-content\">\n      <button type=\"button\" class=\"modal-close-btn\" id=\"modal-close\">\n        <svg class=\"modal-close-icon\" width=\"28\" height=\"28\"><use href=\"${iconSprite}#cross\"></use></svg>\n      </button>\n      <div class=\"modal-exercise-card\">\n        <div class=\"modal-gif-wrapper\">\n          <img src=\"${gifUrl}\" alt=\"${name}\" class=\"modal-gif\" width=\"295\" height=\"258\" />\n        </div>\n        <div class=\"modal-details\">\n          <h2 class=\"modal-title\">${name}</h2>\n          <div class=\"modal-rating-row\">\n              <span class=\"modal-rating-value\">${rating.toFixed(1)}</span>\n              ${renderStars(rating)}\n          </div>\n          <ul class=\"modal-stats-list\">\n            <li class=\"modal-stat-item\"><span>Target</span> <strong>${target}</strong></li>\n            <li class=\"modal-stat-item\"><span>Body Part</span> <strong>${bodyPart}</strong></li>\n            <li class=\"modal-stat-item\"><span>Equipment</span> <strong>${equipment}</strong></li>\n            <li class=\"modal-stat-item\"><span>Popular</span> <strong>${popularity}</strong></li>\n            <li class=\"modal-stat-item\"><span>Burned calories</span> <strong>${burnedCalories}/3 min</strong></li>\n          </ul>\n          <p class=\"modal-description\">${description}</p>\n          <div class=\"modal-btns\">\n            <button class=\"btn-favorite\" data-id=\"${_id}\">Add to favorites</button>\n            <button class=\"btn-rating\" type=\"button\">Give a rating</button>\n          </div>\n        </div>\n      </div>\n    </div>`;\n}\n\nfunction renderStars(rating) {\n  let stars = '';\n  for (let i = 1; i <= 5; i++) {\n    const isFilled = i <= Math.round(rating);\n    const color = isFilled ? '#EEA10C' : 'rgba(244, 244, 244, 0.2)';\n\n    stars += `\n        <span style=\"display: inline-flex;\">\n            <svg class=\"modal-star-icon\" width=\"18\" height=\"18\" style=\"fill: ${color}; stroke: ${color}\">\n                <use href=\"${iconSprite}#star\"></use>\n            </svg>\n        </span>`;\n  }\n  return `<div class=\"modal-stars\">${stars}</div>`;\n}\n"],"names":["modalBackdrop","exercisesList","currentExerciseData","e","startBtn","data","getExerciseById","openModal","err","createModalMarkup","handleEsc","initFavoriteBtn","favBtn","isFavorite","item","updateFavBtnState","currentFavs","index","btn","isFav","iconSprite","closeModal","event","createRatingMarkup","initRatingLogic","selectedRating","radios","ratingValueLabel","form","labels","radio","label","labelValue","icon","email","comment","patchRating","_b","_a","exerciseId","i","gifUrl","name","rating","target","bodyPart","equipment","popularity","burnedCalories","description","_id","renderStars","stars","color"],"mappings":"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"}